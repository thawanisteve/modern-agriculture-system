{
  "version": 3,
  "sources": ["../../../../../../node_modules/@genkit-ai/core/lib/async.js", "../../../../../../node_modules/genkit/lib/client/client.js", "../../../../../../node_modules/genkit/lib/client/index.mjs"],
  "sourcesContent": ["\"use strict\";\n\nvar __defProp = Object.defineProperty;\nvar __getOwnPropDesc = Object.getOwnPropertyDescriptor;\nvar __getOwnPropNames = Object.getOwnPropertyNames;\nvar __hasOwnProp = Object.prototype.hasOwnProperty;\nvar __export = (target, all) => {\n  for (var name in all) __defProp(target, name, {\n    get: all[name],\n    enumerable: true\n  });\n};\nvar __copyProps = (to, from, except, desc) => {\n  if (from && typeof from === \"object\" || typeof from === \"function\") {\n    for (let key of __getOwnPropNames(from)) if (!__hasOwnProp.call(to, key) && key !== except) __defProp(to, key, {\n      get: () => from[key],\n      enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable\n    });\n  }\n  return to;\n};\nvar __toCommonJS = mod => __copyProps(__defProp({}, \"__esModule\", {\n  value: true\n}), mod);\nvar async_exports = {};\n__export(async_exports, {\n  Channel: () => Channel,\n  LazyPromise: () => LazyPromise,\n  lazy: () => lazy\n});\nmodule.exports = __toCommonJS(async_exports);\nfunction createTask() {\n  let resolve, reject;\n  let promise = new Promise((res, rej) => [resolve, reject] = [res, rej]);\n  return {\n    resolve,\n    reject,\n    promise\n  };\n}\nclass Channel {\n  ready = createTask();\n  buffer = [];\n  err = null;\n  send(value) {\n    this.buffer.push(value);\n    this.ready.resolve();\n  }\n  close() {\n    this.buffer.push(null);\n    this.ready.resolve();\n  }\n  error(err) {\n    this.err = err;\n    this.ready.reject(err);\n  }\n  [Symbol.asyncIterator]() {\n    return {\n      next: async () => {\n        if (this.err) {\n          throw this.err;\n        }\n        if (!this.buffer.length) {\n          await this.ready.promise;\n        }\n        const value = this.buffer.shift();\n        if (!this.buffer.length) {\n          this.ready = createTask();\n        }\n        return {\n          value,\n          done: !value\n        };\n      }\n    };\n  }\n}\nclass LazyPromise {\n  executor;\n  promise;\n  constructor(executor) {\n    this.executor = executor;\n  }\n  then(onfulfilled, onrejected) {\n    this.promise ??= new Promise(this.executor);\n    return this.promise.then(onfulfilled, onrejected);\n  }\n}\nfunction lazy(fn) {\n  return new LazyPromise((resolve, reject) => {\n    try {\n      resolve(fn());\n    } catch (e) {\n      reject(e);\n    }\n  });\n}\n// Annotate the CommonJS export names for ESM import in node:\n0 && (module.exports = {\n  Channel,\n  LazyPromise,\n  lazy\n});\n", "\"use strict\";\n\nvar __defProp = Object.defineProperty;\nvar __getOwnPropDesc = Object.getOwnPropertyDescriptor;\nvar __getOwnPropNames = Object.getOwnPropertyNames;\nvar __hasOwnProp = Object.prototype.hasOwnProperty;\nvar __export = (target, all) => {\n  for (var name in all) __defProp(target, name, {\n    get: all[name],\n    enumerable: true\n  });\n};\nvar __copyProps = (to, from, except, desc) => {\n  if (from && typeof from === \"object\" || typeof from === \"function\") {\n    for (let key of __getOwnPropNames(from)) if (!__hasOwnProp.call(to, key) && key !== except) __defProp(to, key, {\n      get: () => from[key],\n      enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable\n    });\n  }\n  return to;\n};\nvar __toCommonJS = mod => __copyProps(__defProp({}, \"__esModule\", {\n  value: true\n}), mod);\nvar client_exports = {};\n__export(client_exports, {\n  runFlow: () => runFlow,\n  streamFlow: () => streamFlow\n});\nmodule.exports = __toCommonJS(client_exports);\nvar import_async = require(\"@genkit-ai/core/async\");\nconst __flowStreamDelimiter = \"\\n\\n\";\nfunction streamFlow({\n  url,\n  input,\n  headers\n}) {\n  const channel = new import_async.Channel();\n  const operationPromise = __flowRunEnvelope({\n    url,\n    input,\n    sendChunk: c => channel.send(c),\n    headers\n  });\n  operationPromise.then(() => channel.close(), err => channel.error(err));\n  return {\n    output: operationPromise,\n    stream: channel\n  };\n}\nasync function __flowRunEnvelope({\n  url,\n  input,\n  sendChunk,\n  headers\n}) {\n  const response = await fetch(url, {\n    method: \"POST\",\n    body: JSON.stringify({\n      data: input\n    }),\n    headers: {\n      Accept: \"text/event-stream\",\n      \"Content-Type\": \"application/json\",\n      ...headers\n    }\n  });\n  if (response.status !== 200) {\n    throw new Error(`Server returned: ${response.status}: ${await response.text()}`);\n  }\n  if (!response.body) {\n    throw new Error(\"Response body is empty\");\n  }\n  var reader = response.body.getReader();\n  var decoder = new TextDecoder();\n  let buffer = \"\";\n  while (true) {\n    const result = await reader.read();\n    const decodedValue = decoder.decode(result.value);\n    if (decodedValue) {\n      buffer += decodedValue;\n    }\n    while (buffer.includes(__flowStreamDelimiter)) {\n      const chunk = JSON.parse(buffer.substring(0, buffer.indexOf(__flowStreamDelimiter)).substring(\"data: \".length));\n      if (chunk.hasOwnProperty(\"message\")) {\n        sendChunk(chunk.message);\n      } else if (chunk.hasOwnProperty(\"result\")) {\n        return chunk.result;\n      } else if (chunk.hasOwnProperty(\"error\")) {\n        throw new Error(`${chunk.error.status}: ${chunk.error.message}\n${chunk.error.details}`);\n      } else {\n        throw new Error(\"unkown chunk format: \" + JSON.stringify(chunk));\n      }\n      buffer = buffer.substring(buffer.indexOf(__flowStreamDelimiter) + __flowStreamDelimiter.length);\n    }\n  }\n  throw new Error(\"stream did not terminate correctly\");\n}\nasync function runFlow({\n  url,\n  input,\n  headers\n}) {\n  const response = await fetch(url, {\n    method: \"POST\",\n    body: JSON.stringify({\n      data: input\n    }),\n    headers: {\n      \"Content-Type\": \"application/json\",\n      ...headers\n    }\n  });\n  if (response.status !== 200) {\n    throw new Error(`Server returned: ${response.status}: ${await response.text()}`);\n  }\n  const wrappedResult = await response.json();\n  if (\"error\" in wrappedResult) {\n    if (typeof wrappedResult.error === \"string\") {\n      throw new Error(wrappedResult.error);\n    }\n    throw new Error(JSON.stringify(wrappedResult.error));\n  }\n  return wrappedResult.result;\n}\n// Annotate the CommonJS export names for ESM import in node:\n0 && (module.exports = {\n  runFlow,\n  streamFlow\n});\n", "/**\n * @license\n *\n * Copyright 2024 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { runFlow, streamFlow } from \"./client.js\";\nexport { runFlow, streamFlow };\n"],
  "mappings": "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",
  "names": ["runFlow", "streamFlow"]
}
